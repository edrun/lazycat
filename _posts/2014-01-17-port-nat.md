---
layout: post
title: 端口转发（转） 
tags:
    - nat
---
###实例说明###
>
假设现在外网有一台ADSL直接拨号上网的电脑，所获得的是公网IP（61.168.45.23）。然后它想访问局域网内的电脑
（192.168.1.10）上面的网站。
>
（路由器上已经做好了端口映射。具体规则是：将所有发向自己80端口的数据，都转发到内网的计算机192.168.1.10上。）

###访问过程如下：###
>
①公网电脑（61.168.45.23）向路由器（218.6.146.31）发送请求，要求访问它的80端口。（相同道理，如果是要访问FTP服务器，
     则发送访问路由器21端口的请求。）
>
②路由器收到请求后，按照端口映射的规则，通过内网IP地址192.168.1.1把请求的数据发送到局域网内的计算机192.168.1.10上。
>
③计算机192.168.1.10收到请求后，把自己电脑中网站的数据发送到路由器。
>
④路由器收到计算机192.168.1.10发来的数据后，通过公网IP 218.6.146.31把它们发送到公网的计算机61.168.45.23上去。


###下面我们就结合花生壳，再来说明上面的例子：### 

>
例如

>
我们的花生壳护照abc下有一个域名www.oray.net，那么我们在192.168.1.10上，用护照abc登陆花生壳客户端。这时候，www.oray.net 对应的IP地址就是路由器的公网IP地址218.6.146.31了。具体访问过程如下：
>
①公网电脑（61.168.45.23）的用户输入www.oray.net，想要访问192.168.1.10上的网站。
>
②花生壳的域名服务器告诉计算机61.168.45.23，www.oray.net这个域名对应的IP地址是218.6.146.31。
>
③于是，计算机61.168.45.23向路由器（218.6.146.31）发送请求，要求访问它的80端口。
>
④路由器收到请求后，按照端口映射的规则，通过内网IP地址192.168.1.1把请求的数据发送到局域网内的计算机192.168.1.10上。
>
⑤计算机192.168.1.10收到请求后，把自己电脑中网站的数据发送到路由器。
>
⑥路由器收到计算机192.168.1.10发来的数据后，通过公网IP 218.6.146.31把它们发送到公网的计算机61.168.45.23上去。
>
可以看到，其实正个过程和原来差不多是一样的，只是前面部分稍微有点不同，多了个域名解析过程而已。





